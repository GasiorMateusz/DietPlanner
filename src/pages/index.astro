---
import LandingLayout from "../layouts/LandingLayout.astro";
import LoginForm from "../components/auth/LoginForm";
import { createSupabaseServerClient } from "@/db/supabase.server";

// Redirect to dashboard if already logged in
let user = null;
try {
  const supabase = createSupabaseServerClient(Astro.cookies);
  const {
    data: { user: authenticatedUser },
  } = await supabase.auth.getUser();
  user = authenticatedUser;
} catch (error) {
  // If Supabase client creation fails (e.g., missing env vars), continue without auth
  // User will see login form and can still access the page
  console.error("Failed to initialize Supabase client:", error);
}

if (user) {
  return Astro.redirect("/app/dashboard");
}
---

<LandingLayout>
  <div class="container mx-auto px-4 py-12 max-w-md">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold mb-2">Diet Planner</h1>
      <p class="text-muted-foreground">AI-Powered Meal Planning for Dietitians</p>
    </div>
    <div class="bg-card border rounded-lg p-6 shadow-sm">
      <LoginForm client:load />
    </div>
  </div>
</LandingLayout>
